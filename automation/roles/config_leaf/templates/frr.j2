{% set device = hostvars[inventory_hostname] %}
frr defaults datacenter
hostname {{ device.name|lower }}
username cumulus nopassword
!
service integrated-vtysh-config
!
log syslog informational
!
{% for vxlan_interface in device.vxlan.interfaces %}
{% set vxlan_interface_vars = device.vxlan.interfaces[vxlan_interface] %}
{% if vxlan_interface_vars.vni_type|lower == "l3"%}
vrf {{ vxlan_interface_vars.vrf }}
  vni {{ vxlan_interface_vars.vxlan_id }}
exit-vrf
{% endif %}
{% endfor %}
!
interface lo
 description loopback interface
!
!
{% for interface in device.interfaces %}
{% set interface_vars = device.interfaces[interface] %}
{% if interface_vars.port_type|lower == "uplink" %}
interface {{ interface }}
 ipv6 nd ra-interval 10
 no ipv6 nd suppress-ra
!
{% endif %}
{% endfor %}
router bgp {{ device.asn }}
 bgp router-id {{ device.lo.ipv4 }}
 bgp bestpath as-path multipath-relax
 neighbor fabric peer-group
 neighbor fabric remote-as external
 neighbor fabric bfd
{% for interface in device.interfaces %}
{% set interface_vars = device.interfaces[interface] %}
{% if interface_vars.port_type|lower == "uplink" %}
 neighbor {{ interface }} interface peer-group fabric
{% endif %}
{% endfor %}
 !
 address-family ipv4 unicast
  network {{ device.lo.ipv4 }}/32
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor fabric activate
  advertise-all-vni
 exit-address-family
!
 address-family l2vpn evpn
  advertise ipv4 unicast
 exit-address-family
!
!
line vty
!
