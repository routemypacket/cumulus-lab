# /etc/network/interfaces template for switches (leaf02)
# Created by Ansible

# Loopback interface
auto lo
iface lo inet loopback
  address 10.0.0.12/32
#  clagd-vxlan-anycast-ip 10.0.0.112
  alias loopback interface

# Management interface
auto eth0
iface eth0
    vrf mgmt
    address 10.255.6.4/23
    gateway 10.255.6.1

auto mgmt
iface mgmt
    address 127.0.0.1/8
    vrf-table auto

auto swp1s0
iface swp1s0
 bridge-access 100

auto swp1s1
iface swp1s1
  bridge-access 100

auto swp1s2
iface swp1s2
  bridge-pvid 100

auto swp1s3
iface swp1s3
  bridge-access 100

#auto swp12
#iface swp12

#auto swp13
#iface swp13
#
#auto swp14
#iface swp14

auto swp15
iface swp15

auto swp16
iface swp16

#auto bond01
#iface bond01
#  mtu 9000
#  bond-slaves swp1s0
#  bridge-access 100
#  clag-id 1

# CLAG Peerlink bond
#auto peerlink
#    iface peerlink
#    bond-slaves swp12

# CLAG Peerlink L2 interface.
# This creates VLAN 4094 that only lives on the peerlink bond
# No other interface will be aware of VLAN 4094
#auto peerlink.4094
#iface peerlink.4094
#    address 169.254.1.2/30
#    clagd-peer-ip 169.254.1.1
#    clagd-backup-ip 10.0.0.11
#    clagd-sys-mac 44:39:39:ff:40:94
#    clagd-priority 200


# Define the bridge for STP
auto bridge
iface bridge
    # bridge-ports includes all ports related to VxLAN and CLAG.
    # does not include the Peerlink.4094 subinterface
    bridge-ports swp1s0 swp1s1 swp1s2 swp1s3 vni100 vni400 vxlan4001
    bridge-stp on
    bridge-vids 100 400 4001
    bridge-pvid 1
    bridge-vlan-aware yes
    post-up echo 1 > /proc/sys/net/ipv4/conf/bridge/proxy_arp


auto vxlan4001
iface vxlan4001
     hwaddress 44:39:39:FF:40:95
     vxlan-id 104001
     vxlan-local-tunnelip 10.0.0.12
     bridge-learning off
     bridge-access 4001
     bridge-arp-nd-suppress on

# VxLAN Tunnel for Vlan 100
auto vni100
iface vni100
  mtu 9166
  vxlan-id 10100
  vxlan-local-tunnelip 10.0.0.12
  bridge-access 100
  bridge-arp-nd-suppress on
  bridge-learning off
  mstpctl-bpduguard yes
  mstpctl-portbpdufilter yes

# VxLAN Tunnel for Vlan 400
auto vni400
iface vni400
    mtu 9166
    vxlan-id 10400
    vxlan-local-tunnelip 10.0.0.12
    bridge-access 400
    bridge-arp-nd-suppress on
    bridge-learning off
    mstpctl-bpduguard yes
    mstpctl-portbpdufilter yes


auto public
iface public
   vrf-table auto

auto vlan100
iface vlan100
    address 192.168.0.1/24
    address 192.168.1.1/24
    address 192.168.2.1/24
    address 192.168.3.1/24
    address 192.168.4.1/24
    address 192.168.5.1/24
    address 192.168.6.1/24
    address 192.168.7.1/24
    address 192.168.8.1/24
    address 192.168.9.1/24
    address 192.168.10.1/24
    address 192.168.11.1/24
    address 192.168.12.1/24
    address 192.168.13.1/24
    address 192.168.14.1/24
    address 192.168.15.1/24
    address 192.168.16.1/24
    address 192.168.17.1/24
    address 192.168.18.1/24
    address 192.168.19.1/24
    address 192.168.20.1/24
    address 192.168.21.1/24
    address 192.168.22.1/24
    address 192.168.23.1/24
    address 192.168.24.1/24
    address 192.168.25.1/24
    address 192.168.26.1/24
    address 192.168.27.1/24
    address 192.168.28.1/24
    address 192.168.29.1/24
    address 192.168.30.1/24
    address 192.168.31.1/24
    address 192.168.32.1/24
    address 192.168.33.1/24
    address 192.168.34.1/24
    address 192.168.35.1/24
    address 192.168.36.1/27
    address 192.168.37.1/27
    address 192.168.38.1/27
    address 192.168.39.1/27
    address 192.168.40.1/27
    address 192.168.41.1/27
    address 192.168.42.1/27
    address 192.168.43.1/27
    address 192.168.44.1/27
    address 192.168.45.1/27
    address 192.168.46.1/27
    address 192.168.47.1/27
    address 192.168.48.1/27
    address 192.168.49.1/27
    address 192.168.50.1/27
    address 192.168.51.1/27
    address 192.168.52.1/27
    address 192.168.53.1/27
    address 192.168.54.1/27
    address 192.168.55.1/27
    address 192.168.56.1/27
    address 192.168.57.1/27
    address 192.168.58.1/27
    address 192.168.59.1/27
    address 192.168.60.1/27
    address 192.168.61.1/27
    address 192.168.62.1/27
    address 192.168.63.1/27
    address 192.168.64.1/27
    address 192.168.65.1/27
    address 192.168.66.1/27
    address 192.168.67.1/27
    address 192.168.68.1/27
    address 192.168.69.1/28
    address 192.168.70.1/28
    address 192.168.71.1/28
    address 192.168.72.1/28
    address 192.168.73.1/28
    address 192.168.74.1/28
    address 192.168.75.1/28
    address 192.168.76.1/28
    address 192.168.78.1/28
    address 192.168.79.1/28
    address 192.168.80.1/28
    address 192.168.81.1/28
    address 192.168.82.1/28
    address 192.168.83.1/28
    address 192.168.84.1/28
    address 192.168.85.1/28
    address 192.168.86.1/28
    address 192.168.87.1/28
    address 192.168.88.1/28
    address 192.168.89.1/28
    address 192.168.90.1/28
    address 192.168.91.1/28
    address 192.168.92.1/28
    address 192.168.93.1/28
    address 192.168.94.1/28
    address 192.168.95.1/28
    address 2A02:2498:E004:4D::1/113
    address 2A02:2498:E004:5D::1/113
    address 185.2.136.241/28
    vlan-id 100
    vlan-raw-device bridge
    vrf public

#L3 VLAN interface per tenant (for L3 VNI)

auto vlan4001
iface vlan4001
    vlan-id 4001
    vlan-raw-device bridge
    vrf public
